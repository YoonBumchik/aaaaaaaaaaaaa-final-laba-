<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="финалка.css">
    <title>Document</title>
</head>
<body background="https://get.wallhere.com/photo/Honkai-Star-Rail-anime-girls-anime-pink-hair-Japanese-2114351.jpg">
    <textarea id = "name"></textarea>
	<textarea id = "password"></textarea>
        
            <td><button id="register" onclick="singup()">Зарегистрироваться</button></td>
            <td><button id="login" onclick="login()">Войти</button></td>

            <table id="pompom">
<tr>
    <td><button onclick="let a = new person; a.checkbalance()" id="button1" disabled>Проверить баланс</button></td>
    <td><button onclick="let b = new person; b.topupwmoney()" id="button2" disabled>Пополнить счет</button></td>
</tr>
<tr>
    <td><button onclick="let c = new person; c.Wasteofmoney()" id="button3" disabled>Добавить трату</button></td>
    <td><button onclick="let d = new person; d.Predict()" id="button4" disabled>Предсказание трат\пополнения</button></td>
</tr>
<tr>
    <td><button onclick="let i = new person; i.payformonth()" id="button5" disabled>Траты за месяц</button></td>
    <td><button onclick="let g = new person; g.payforall()" id="button6" disabled>Все траты</button></td>
</tr>
</table>

    <script>
        //Выше набор кнопок с атрибутами onclick, которые создают новый объект класса "person" и вызывают методы этого объекта при нажатии на кнопку. 
    //Кнопки имеют id и атрибут disabled, что означает, что они неактивны и не могут быть нажаты, пока не будет выполнено какое-то условие.
        let names = [];
  	    let passwords = [];
        function login() {
    let login = document.getElementById("name").value;
    let password = document.getElementById("password").value;

	for(let index = 0; index <= names.length && index <= passwords.length; index++){
		if(login == names[index] && password == passwords[index]){
			var check = 1;
		} //Функция "login" получает значения из полей ввода "name" и "password" и проверяет, есть ли такой пользователь в массивах "names" и "passwords".
	}
    if (check == 1) {
      alert("Вход одобрен");
        let button7 = document.getElementById('register').disabled = true
        let button8 = document.getElementById('login').disabled = true
        let button1 = document.getElementById('button1').disabled = false
        let button2 = document.getElementById('button2').disabled = false
        let button3 = document.getElementById('button3').disabled = false
        let button4 = document.getElementById('button4').disabled = false
        let button5 = document.getElementById('button5').disabled = false
        let button6 = document.getElementById('button6').disabled = false
    } else alert("Вход отклонен");
    } //Если пользователь найден, то кнопки "register" и "login" становятся неактивными, а кнопки с id "button1"-"button6" становятся активными. Если пользователь не найден, выводится сообщение об ошибке.

        function singup() {
    let login = document.getElementById("name").value;
    let password = document.getElementById("password").value;

    let nameTaken = names.includes(login); 
    //singup получает значения из полей ввода "name" и "password" и проверяет, есть ли уже такой пользователь в массиве "names".

    if (!nameTaken) {
      names.push(login);
      passwords.push(password);
      alert("Регистрация завершена");
    } //Если пользователь не найден, то его имя и пароль добавляются в соответствующие массивы, и выводится сообщение об успешной регистрации. 

	else {
        alert("Регистрация не завершена");
    } //Если пользователь уже существует, выводится сообщение об ошибке.
  }
        let arr1 = []
        let arr1_1 = []
        let arr2 = []
        let arr2_2 = []
        let arr3 = []
        let arr3_3 = []
        let arr4 = []
        let arr4_4 = []

        function getMonthFromDate(dateString) {
                let date = new Date(dateString);
                let month = date.getMonth() + 1;
                return month;}
                //Функция "getMonthFromDate" принимает строку с датой и возвращает номер месяца. 

        class spend{
            constructor(month, category, amount){
                this.month = month
                this.category = category
                this.amount = amount
            }
        }
        class second_spend{
            constructor(month, category, amount){
                this.month = month
                this.category = category
                this.amount = amount
            }
        } //Классы "spend" и "second_spend" содержат информацию о месяце, категории и сумме расходов.

        class  Topupwithmoney{
            constructor(amount){
                this.amount = amount
        }}
        class second_badtrip{
            constructor(amount){
                this.amount = amount
        }} //Классы "Topupwithmoney" и "second_badtrip" содержат информацию о сумме доходов.

        class Balance{
            constructor(Balance){
                this.Balance = Balance
            }
        }
        class second_balance{
            constructor(Balance){
                this.Balance = balance
            }
        } //Классы "Balance" и "second_balance" содержат информацию о текущем балансе.

        class person{
            Wasteofmoney()
            //метод запрашивает у пользователя информацию о покупке (карта, дата, категория, сумма)
            {
                let card = prompt("Какая карта будет использована")
                let buyDate = prompt("Дата покупки")
                let category = prompt("Категория")
                let amount = prompt("Cумма")

                if(card == 1)
                {
                    let BuyMonth = getMonthFromDate(buyDate)
                    arr1.push(new spend(BuyMonth, buyDate, parseInt(amount)))
                    localStorage.setItem("spend", JSON.stringify(arr1))
                    console.log(arr1)
                } else
                {
                    let BuyMonth = getMonthFromDate(buyDate)
                    arr1_1.push(new second_spend(BuyMonth, buyDate, parseInt(amount)))
                    localStorage.setItem("second_spend", JSON.stringify(arr1_1))
                    console.log(arr1_1)
                } //в зависимости от выбора карты, создает объект класса "spend" или "second_spend" и добавляет его в соответствующий массив ("arr1" или "arr1_1")

            }
            topupwmoney(){
                let card = prompt("какая карта будет использована")
                let amount = prompt("сумма прихода")
                if(card == 1)
                {
                    arr2.push(new  Topupwithmoney (parseInt(amount)))
                    localStorage.setItem("badtrip", JSON.stringify(arr2))
                    console.log(arr2)
                }else
                {
                    arr2_2.push(new second_badtrip(amount))
                    localStorage.setItem("second_badtrip", JSON.stringify(arr2_2))
                    console.log(arr2_2)
                } //сохраняет массив в локальное хранилище и выводит его в консоль
            }

            checkbalance()
            ////запрашивает у пользователя информацию о карте, которую он хочет использовать, а затем считает баланс этой карты.
            {
                let sum = 0
                let card = prompt("какая карта будет использована")
                if (card == 1) 
                {
                    let maxlength = Math.max(arr2.length, arr1.length)
                    for(let i = 0; i < maxlength; i++)
                    {
                      if (arr1[i] !== undefined)
                        {
                            sum -= arr1[i].amount;
                        }
                      if (arr2[i] !== undefined)
                        {
                            sum += arr2[i].amount 
                        }
                    }
                    arr3.push(new Balance(sum))
                    localStorage.setItem("Баланс", JSON.stringify(arr3))
                    console.log(arr3)
                    //Если пользователь выбирает карту "1", то функция суммирует все расходы из массива "arr1" и вычитает их из суммы, а затем суммирует все доходы из массива "arr2" и прибавляет их к сумме. Полученная сумма записывается в объект класса "Balance" и добавляется в массив "arr3".

                }else
                {
                    let maxlength = Math.max(arr2_2.length, arr1_1.length)
                    for(let i = 0; i < maxlength; i++){
                      if (arr1_1[i] !== undefined){
                        sum -= arr1_1[i].amount;
                    }
                      if (arr2_2[i] !== undefined){
                        sum += arr2_2[i].amount 
                    }
                    }
                    arr3_3.push(new balance(sum))
                    localStorage.setItem("second_balance", JSON.stringify(arr3_3))
                    console.log(localStorage.getItem("second_balance"))
                    //В конце функция сохраняет массив в локальное хранилище и выводит его в консоль.
                }   
                    }

            payformonth()
            //запрашивает у пользователя информацию о карте, которую он хочет использовать и месяце, в котором была совершена покупка.
            {
                let card = prompt("Какая карта будет использована")
                let month = prompt("В каком месяце была покупка")
                if (card == 1)
                {
                    let a = getMonthFromDate(month)
                    for(let index = 0; index < arr1.length; index++)
                    {
                        if(arr1[index].month === a)
                        {
                            arr4.push(arr1[index])
                        }
                    }
                    var get = arr4.reduce((sum, arr4) => sum + arr4.amount, 0)
                    console.log(get)
                    //Если пользователь выбирает карту "1", то функция находит все расходы из массива "arr1" за указанный месяц и записывает их в массив "arr4". Затем функция суммирует все суммы из массива "arr4" и выводит результат в консоль.
                } else 
                {
                    for(let i = 0; i < arr1_1.length; i++)
                    {
                        if(arr1_1[i].month == monthe)
                        {
                            arr4_4.push(arr1_1[i])
                        }
                    }
                    get = arr4_4.reduce((sum, arr4_4) => sum + arr4_4.amount, 0)
                    console.log(get)
                }
            }

            payforall()
            //запрашивает у пользователя информацию о карте, которую он хочет использовать, и сохраняет ответ в переменной card.
            {
                let card = prompt("какая карта будет использована")
                if (card == 1)
                {
                    // общая сумма трат
                    let totalExpenses = arr1.reduce((sum, expense) => sum + expense.amount, 0);
                    //Если пользователь выбирает карту "1", то функция находит все расходы из массива arr1 и суммирует их с помощью метода reduce(), сохраняя общую сумму трат в переменной totalExpenses. 
                    let categories = {};
                    //Затем функция создает пустой объект categories
                    arr1.forEach(expense => {
                        //и проходит по каждому элементу массива arr1 с помощью метода forEach(). 
                    if (categories[expense.category]) {
                        //Для каждого расхода функция проверяет, есть ли уже категория в объекте categories. 
                        categories[expense.category] += expense.amount;
                        //Если есть, то функция добавляет сумму расхода к соответствующей категории. 
                    } else {
                        categories[expense.category] = expense.amount;
                        }});
                        //Если нет, то функция создает новую категорию и добавляет к ней сумму расхода. 
                    
                        let percentages = {};
                        //После этого функция создает пустой объект percentages
                        Object.entries(categories).forEach(([category, amount]) => {
                            //и проходит по каждой категории в объекте categories с помощью метода Object.entries(). 
                        percentages[category] = (amount / totalExpenses) * 100;})
                        //Для каждой категории функция вычисляет процент от общей суммы трат и записывает его в объект percentages. 
                        let sortedCategories = Object.keys(percentages).sort((a, b) => percentages[b] - percentages[a]);
                        //Затем функция сортирует категории в порядке убывания процентов 

                        console.log(percentages);
                        //и выводит объект percentages в консоль.
                }
            }

            Predict()
            //запрашивает у пользователя информацию о карте, которую он хочет использовать, и сохраняет ответ в переменной card.
            {
                let card = prompt("какая карта будет использована")
                if(card == 1)
                //Если пользователь выбирает карту "1"
                {
                    let predictspend = arr1.reduce((sum, expense) => sum + expense.amount, 0);
                    predictspend *= .5
                    //функция находит все расходы из массива arr1 и суммирует их с помощью метода reduce(), сохраняя общую сумму трат в переменной predictspend. 
                    //Затем функция умножает predictspend на 0.5 и сохраняет результат в той же переменной.
                    let predictbadtrip = arr2.reduce((sum, expense) => sum + expense.amount, 0);
                    predictbadtrip *= .5
                    //Далее функция находит все расходы из массива arr2 и суммирует их с помощью метода reduce(), сохраняя общую сумму расходов на плохие поездки в переменной predictbadtrip.
                    //Затем функция умножает predictbadtrip на 0.5 и сохраняет результат в той же переменной.
                    console.log("ожидание прихода", predictbadtrip, "предикт трат", predictspend)
                    //После этого функция выводит значения predictbadtrip и predictspend в консоль.
                } else
                {
                    let predictspend = arr1_1.reduce((sum, expense) => sum + expense.amount, 0);
                    predictspend *= .5
                    let predictbadtrip = arr2_2.reduce((sum, expense) => sum + expense.amount, 0);
                    predictbadtrip *= .5
                    console.log("ожидание прихода", predictbadtrip, "предикт трат", predictspend)
                }
            }
        }
    </script>
</body>
</html>